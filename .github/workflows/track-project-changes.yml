name: Log Column Change to Issue
on:
  repository_dispatch:
    types: [project_field_updated]

jobs:
  comment_on_change:
    runs-on: ubuntu-latest
    steps:
      - name: Post comment on linked issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }} # PROJECT_TRACKING_TODEN
          script: |
            const { item, changes } = context.payload;
            
            // 1. Check if the edited item is an Issue (not a Draft or PR)
            if (item.content_type !== 'Issue') return;

            // 2. Identify what changed (e.g., a field named "Priority" or "Status")
            // Note: GitHub's payload structure for project_item can be nested
            const fieldName = changes.field_value?.field_name;
            const newValue = changes.field_value?.field_value;

            if (fieldName) {
              const issueNumber = item.content_node_id; // Use GraphQL ID or parse from URL
              const commentBody = `ðŸ¤– **Project Update:** Field *${fieldName}* was changed to **${newValue}**.`;

              // 3. Post the comment
              // Note: You'll need the repo owner and name from the item content
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: item.number,
                body: commentBody
              });
            }
