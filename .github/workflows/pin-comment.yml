name: Auto-Pin Status Update

on:
  issue_comment:
    types: [created, edited]

jobs:
  pin-status:
    # 1. Triggers on the exact Markdown header + emoji
    # 2. Ensures we only attempt this on Issues (since PRs don't support pinning yet)
    if: |
      startsWith(github.event.comment.body, '## ðŸ”„ Status Update') && 
      github.event.issue.pull_request == null
    
    runs-on: ubuntu-latest

    steps:
      - name: Pin the Status Update
        env:
          # Use the Secret containing your focus-automation PAT
          GITHUB_TOKEN: ${{ secrets.FOCUS_AUTOMATION_PAT }}
          COMMENT_ID: ${{ github.event.comment.id }}
        run: |
          echo "Attempting to pin comment $COMMENT_ID..."
          gh api \
            --method PUT \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            /repos/${{ github.repository }}/issues/comments/$COMMENT_ID/pin
