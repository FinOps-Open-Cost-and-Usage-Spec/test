name: Auto-Pin Status Update

on:
  issue_comment:
    # Trigger on both new posts and edits
    types: [created, edited]

jobs:
  pin-status:
    # 1. Match the specific Header + Emoji
    # 2. Ensure it is an Issue (not a PR)
    if: |
      startsWith(github.event.comment.body, '## ðŸ”„ Status Update') && 
      github.event.issue.pull_request == null
    
    runs-on: ubuntu-latest
    
    permissions:
      issues: write

    steps:
      - name: Pin the Status Update
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          COMMENT_ID: ${{ github.event.comment.id }}
        run: |
          # The PUT method is idempotent, so if it is already pinned, 
          # it will just refresh the pin or return a 204 No Content.
          gh api \
            --method PUT \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            /repos/${{ github.repository }}/issues/comments/$COMMENT_ID/pin
